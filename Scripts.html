<script>
/* ==================== Global Variables ==================== */
let dashboardData = null;
let charts = {};
let currentMonth = null;

/* ==================== Initialization ==================== */
document.addEventListener('DOMContentLoaded', function() {
  initializeNavigation();
  loadDashboardData();
});

function initializeNavigation() {
  // Navigation click handlers
  document.querySelectorAll('.nav-item[data-section]').forEach(item => {
    item.addEventListener('click', function(e) {
      e.preventDefault();
      const section = this.getAttribute('data-section');
      showSection(section);
    });
  });

  // Chart range buttons
  document.querySelectorAll('.chart-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const range = this.getAttribute('data-range');
      document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      updateChartRange(range);
    });
  });
}

/* ==================== Data Loading ==================== */
function loadDashboardData() {
  showLoading(true);

  google.script.run
    .withSuccessHandler(function(data) {
      dashboardData = data;
      currentMonth = data.latestMonth;
      populateMonthSelector(data.months);
      updateDashboard(data);
      showLoading(false);
    })
    .withFailureHandler(function(error) {
      showToast('error', 'Error', 'Failed to load data: ' + error.message);
      showLoading(false);
      // Load demo data for preview
      loadDemoData();
    })
    .getDashboardData();
}

function loadDemoData() {
  // Demo data for preview when not connected to Google Sheets
  dashboardData = {
    latestMonth: 'NOV-2025',
    months: ['JAN-2025', 'FEB-2025', 'MAR-2025', 'APR-2025', 'MAY-2025', 'JUN-2025', 'JUL-2025', 'AUG-2025', 'SEP-2025', 'OCT-2025', 'NOV-2025'],
    kpi: {
      bankBalance: 2498320.62,
      bankChange: 5.2,
      outstanding: 2179683.50,
      outstandingChange: 5.7,
      advances: 540959.39,
      advancesChange: -2.1,
      suspense: -17267.64,
      suspenseChange: 0
    },
    ytd: {
      received: 28577792.19,
      payments: 27400972.16,
      netFlow: 1176820.03,
      months: 11
    },
    banks: {
      labels: ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV'],
      balance: [1500000, 1800000, 2100000, 1900000, 2300000, 2500000, 2200000, 2400000, 2600000, 2450000, 2498320],
      received: [2500000, 2800000, 2600000, 2700000, 2900000, 2400000, 2600000, 2800000, 2700000, 2500000, 2600000],
      payments: [2200000, 2500000, 2400000, 2900000, 2500000, 2200000, 2800000, 2600000, 2500000, 2650000, 2550000]
    },
    outstanding: {
      labels: ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV'],
      total: [1795869, 1589925, 1507837, 1716100, 2287954, 2189458, 2399787, 2026772, 2023784, 2063023, 2179683],
      salesmen: [
        { name: 'company sales', value: 976412.87, trend: -7.6 },
        { name: 'arshad', value: 486637.40, trend: 32.8 },
        { name: 'dhiya', value: 270754.61, trend: 10.2 },
        { name: 'Shameer riyadh', value: 92907.92, trend: 27.9 },
        { name: 'khalid', value: 89837.02, trend: -9.3 },
        { name: 'nidheesh', value: 79345.24, trend: 3.3 },
        { name: 'akmal', value: 34121.05, trend: -25.5 },
        { name: 'bassam', value: 22733.87, trend: -9.9 },
        { name: 'jaseel', value: 19951.36, trend: -2.7 },
        { name: 'shafi', value: 18398.82, trend: 6.6 }
      ]
    },
    advances: {
      labels: ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV'],
      opening: [163800, 479608, 489038, 491564, 541048, 472788, 504240, 452575, 473840, 504511, 540959],
      given: [629615, 813275, 653526, 752494, 615975, 678880, 577549, 618079, 681421, 0, 0],
      settled: [313807, 803845, 651000, 703010, 684235, 647427, 629214, 596814, 650750, 0, 0],
      closing: [479608, 489038, 491564, 541048, 472788, 504240, 452575, 473840, 504511, 540959, 540959]
    },
    suspense: {
      labels: ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV'],
      balance: [-17267, -15000, -12000, -14000, -16000, -13000, -15000, -17000, -16500, -17000, -17267]
    },
    bankAccounts: [
      { name: 'Alrajhi-1097', balance: 210693.67, change: 0 },
      { name: 'Alrajhi-new', balance: 564500.97, change: 0 },
      { name: 'SNB Al Ahsa Branch', balance: 1562570.61, change: 0 },
      { name: 'Albilad', balance: 160054.48, change: 0 },
      { name: 'Albilad USD', balance: 133.57, change: 0 }
    ]
  };

  currentMonth = dashboardData.latestMonth;
  populateMonthSelector(dashboardData.months);
  updateDashboard(dashboardData);
}

/* ==================== Dashboard Updates ==================== */
function updateDashboard(data) {
  updateKPIs(data.kpi);
  updateYTD(data.ytd);
  updateCharts(data);
  updateTables(data);
}

function updateKPIs(kpi) {
  // Bank Balance
  document.getElementById('kpi-bank-balance').textContent = formatCurrency(kpi.bankBalance);
  updateChangeIndicator('kpi-bank-change', kpi.bankChange, true);

  // Outstanding
  document.getElementById('kpi-outstanding').textContent = formatCurrency(kpi.outstanding);
  updateChangeIndicator('kpi-outstanding-change', kpi.outstandingChange, false); // Higher is bad

  // Advances
  document.getElementById('kpi-advances').textContent = formatCurrency(kpi.advances);
  updateChangeIndicator('kpi-advances-change', kpi.advancesChange, false);

  // Suspense
  document.getElementById('kpi-suspense').textContent = formatCurrency(kpi.suspense);
  updateChangeIndicator('kpi-suspense-change', kpi.suspenseChange, false);
}

function updateChangeIndicator(elementId, change, higherIsGood) {
  const element = document.getElementById(elementId);
  const isPositive = change > 0;
  const isGood = higherIsGood ? isPositive : !isPositive;

  element.className = 'kpi-change ' + (isGood ? 'positive' : 'negative');
  element.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="${isPositive ? '23 6 13.5 15.5 8.5 10.5 1 18' : '23 18 13.5 8.5 8.5 13.5 1 6'}"/>
    </svg>
    ${isPositive ? '+' : ''}${change.toFixed(1)}%
  `;
}

function updateYTD(ytd) {
  document.getElementById('ytd-received').textContent = formatCurrency(ytd.received);
  document.getElementById('ytd-payments').textContent = formatCurrency(ytd.payments);
  document.getElementById('ytd-netflow').textContent = formatCurrency(ytd.netFlow);
  document.getElementById('ytd-months').textContent = ytd.months;
}

/* ==================== Charts ==================== */
function updateCharts(data) {
  createCashFlowChart(data.banks);
  createOutstandingPieChart(data.outstanding.salesmen);
  createBankTrendChart(data.banks);
  createOutstandingTrendChart(data.outstanding);
  createSalesmanDistChart(data.outstanding.salesmen);
  createAdvancesTrendChart(data.advances);
  createSuspenseTrendChart(data.suspense);
}

function createCashFlowChart(data) {
  const ctx = document.getElementById('cashFlowChart');
  if (!ctx) return;

  if (charts.cashFlow) charts.cashFlow.destroy();

  charts.cashFlow = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [
        {
          label: 'Balance',
          data: data.balance,
          borderColor: '#4F46E5',
          backgroundColor: 'rgba(79, 70, 229, 0.1)',
          fill: true,
          tension: 0.4,
          borderWidth: 2
        },
        {
          label: 'Received',
          data: data.received,
          borderColor: '#10B981',
          backgroundColor: 'transparent',
          borderDash: [5, 5],
          tension: 0.4,
          borderWidth: 2
        },
        {
          label: 'Payments',
          data: data.payments,
          borderColor: '#EF4444',
          backgroundColor: 'transparent',
          borderDash: [5, 5],
          tension: 0.4,
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 20
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: false,
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      },
      interaction: {
        intersect: false,
        mode: 'index'
      }
    }
  });
}

function createOutstandingPieChart(salesmen) {
  const ctx = document.getElementById('outstandingPieChart');
  if (!ctx) return;

  if (charts.outstandingPie) charts.outstandingPie.destroy();

  const top5 = salesmen.slice(0, 5);
  const othersValue = salesmen.slice(5).reduce((sum, s) => sum + s.value, 0);

  const labels = top5.map(s => s.name);
  const values = top5.map(s => s.value);

  if (othersValue > 0) {
    labels.push('Others');
    values.push(othersValue);
  }

  charts.outstandingPie = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: [
          '#4F46E5',
          '#10B981',
          '#F59E0B',
          '#EF4444',
          '#8B5CF6',
          '#6B7280'
        ],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'right',
          labels: {
            usePointStyle: true,
            padding: 15,
            font: {
              size: 11
            }
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((context.raw / total) * 100).toFixed(1);
              return context.label + ': ' + formatCurrency(context.raw) + ' (' + percentage + '%)';
            }
          }
        }
      },
      cutout: '60%'
    }
  });
}

function createBankTrendChart(data) {
  const ctx = document.getElementById('bankTrendChart');
  if (!ctx) return;

  if (charts.bankTrend) charts.bankTrend.destroy();

  charts.bankTrend = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.labels,
      datasets: [
        {
          label: 'Received',
          data: data.received,
          backgroundColor: 'rgba(16, 185, 129, 0.8)',
          borderRadius: 4
        },
        {
          label: 'Payments',
          data: data.payments,
          backgroundColor: 'rgba(239, 68, 68, 0.8)',
          borderRadius: 4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}

function createOutstandingTrendChart(data) {
  const ctx = document.getElementById('outstandingTrendChart');
  if (!ctx) return;

  if (charts.outstandingTrend) charts.outstandingTrend.destroy();

  charts.outstandingTrend = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [{
        label: 'Total Outstanding',
        data: data.total,
        borderColor: '#EF4444',
        backgroundColor: 'rgba(239, 68, 68, 0.1)',
        fill: true,
        tension: 0.4,
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: false,
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}

function createSalesmanDistChart(salesmen) {
  const ctx = document.getElementById('salesmanDistChart');
  if (!ctx) return;

  if (charts.salesmanDist) charts.salesmanDist.destroy();

  charts.salesmanDist = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: salesmen.map(s => s.name),
      datasets: [{
        label: 'Outstanding',
        data: salesmen.map(s => s.value),
        backgroundColor: salesmen.map((s, i) => {
          const colors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4', '#84CC16', '#F97316', '#6366F1'];
          return colors[i % colors.length];
        }),
        borderRadius: 4
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        x: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          }
        },
        y: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}

function createAdvancesTrendChart(data) {
  const ctx = document.getElementById('advancesTrendChart');
  if (!ctx) return;

  if (charts.advancesTrend) charts.advancesTrend.destroy();

  charts.advancesTrend = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [
        {
          label: 'Closing Balance',
          data: data.closing,
          borderColor: '#F59E0B',
          backgroundColor: 'rgba(245, 158, 11, 0.1)',
          fill: true,
          tension: 0.4,
          borderWidth: 2
        },
        {
          label: 'Given',
          data: data.given,
          borderColor: '#10B981',
          backgroundColor: 'transparent',
          borderDash: [5, 5],
          tension: 0.4,
          borderWidth: 2
        },
        {
          label: 'Settled',
          data: data.settled,
          borderColor: '#4F46E5',
          backgroundColor: 'transparent',
          borderDash: [5, 5],
          tension: 0.4,
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });

  // Update advances KPIs
  const latestIdx = data.closing.length - 1;
  document.getElementById('adv-opening').textContent = formatCurrency(data.opening[latestIdx]);
  document.getElementById('adv-given').textContent = formatCurrency(data.given[latestIdx]);
  document.getElementById('adv-settled').textContent = formatCurrency(data.settled[latestIdx]);
  document.getElementById('adv-closing').textContent = formatCurrency(data.closing[latestIdx]);
}

function createSuspenseTrendChart(data) {
  const ctx = document.getElementById('suspenseTrendChart');
  if (!ctx) return;

  if (charts.suspenseTrend) charts.suspenseTrend.destroy();

  charts.suspenseTrend = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [{
        label: 'Suspense Balance',
        data: data.balance,
        borderColor: '#F59E0B',
        backgroundColor: 'rgba(245, 158, 11, 0.1)',
        fill: true,
        tension: 0.4,
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return formatCurrency(context.raw);
            }
          }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: function(value) {
              return formatCompact(value);
            }
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });

  // Update suspense KPIs
  const latestIdx = data.balance.length - 1;
  document.getElementById('sus-opening').textContent = formatCurrency(data.balance[0]);
  document.getElementById('sus-debits').textContent = '--';
  document.getElementById('sus-credits').textContent = '--';
  document.getElementById('sus-closing').textContent = formatCurrency(data.balance[latestIdx]);
}

/* ==================== Tables ==================== */
function updateTables(data) {
  updateTopOutstandingTable(data.outstanding.salesmen);
  updateBankSummaryTable(data.bankAccounts);
  updateOutstandingTable(data.outstanding.salesmen);
}

function updateTopOutstandingTable(salesmen) {
  const tbody = document.getElementById('top-outstanding-table');
  if (!tbody) return;

  const top5 = salesmen.slice(0, 5);
  tbody.innerHTML = top5.map(s => `
    <tr>
      <td>${capitalizeFirst(s.name)}</td>
      <td class="amount">${formatCurrency(s.value)}</td>
      <td class="${s.trend > 0 ? 'trend-up' : 'trend-down'}">
        ${s.trend > 0 ? '▲' : '▼'} ${Math.abs(s.trend).toFixed(1)}%
      </td>
    </tr>
  `).join('');
}

function updateBankSummaryTable(banks) {
  const tbody = document.getElementById('bank-summary-table');
  if (!tbody) return;

  tbody.innerHTML = banks.map(b => `
    <tr>
      <td>${b.name}</td>
      <td class="amount">${formatCurrency(b.balance)}</td>
      <td class="${b.change >= 0 ? 'positive' : 'negative'}">
        ${b.change >= 0 ? '+' : ''}${b.change.toFixed(1)}%
      </td>
    </tr>
  `).join('');
}

function updateOutstandingTable(salesmen) {
  const table = document.getElementById('outstanding-table');
  if (!table) return;

  table.innerHTML = `
    <thead>
      <tr>
        <th>Salesman</th>
        <th>Outstanding</th>
        <th>Customers</th>
        <th>Trend</th>
      </tr>
    </thead>
    <tbody>
      ${salesmen.map(s => `
        <tr>
          <td>${capitalizeFirst(s.name)}</td>
          <td class="amount">${formatCurrency(s.value)}</td>
          <td>--</td>
          <td class="${s.trend > 0 ? 'trend-up' : 'trend-down'}">
            ${s.trend > 0 ? '▲' : '▼'} ${Math.abs(s.trend).toFixed(1)}%
          </td>
        </tr>
      `).join('')}
    </tbody>
  `;
}

/* ==================== UI Functions ==================== */
function showSection(sectionId) {
  // Update navigation
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
    if (item.getAttribute('data-section') === sectionId) {
      item.classList.add('active');
    }
  });

  // Update sections
  document.querySelectorAll('.section').forEach(section => {
    section.classList.remove('active');
  });

  const targetSection = document.getElementById(sectionId + '-section');
  if (targetSection) {
    targetSection.classList.add('active');
  }

  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');
}

function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('collapsed');
  sidebar.classList.toggle('open');
}

function populateMonthSelector(months) {
  const select = document.getElementById('monthSelect');
  if (!select) return;

  select.innerHTML = months.slice().reverse().map(m =>
    `<option value="${m}" ${m === currentMonth ? 'selected' : ''}>${m}</option>`
  ).join('');
}

function changeMonth(month) {
  currentMonth = month;
  showLoading(true);

  google.script.run
    .withSuccessHandler(function(data) {
      updateDashboard(data);
      showLoading(false);
    })
    .withFailureHandler(function(error) {
      showToast('error', 'Error', 'Failed to load month data');
      showLoading(false);
    })
    .getDashboardDataForMonth(month);
}

function refreshData() {
  loadDashboardData();
  showToast('success', 'Refreshing', 'Data is being refreshed...');
}

function updateChartRange(range) {
  // TODO: Implement chart range filtering
  console.log('Chart range:', range);
}

/* ==================== Actions ==================== */
function exportReport() {
  showLoading(true);
  google.script.run
    .withSuccessHandler(function(url) {
      showLoading(false);
      showToast('success', 'Export Complete', 'PDF has been created');
      if (url) window.open(url, '_blank');
    })
    .withFailureHandler(function(error) {
      showLoading(false);
      showToast('error', 'Export Failed', error.message);
    })
    .exportToPDF();
}

function generateReport(type) {
  showToast('info', 'Generating Report', 'Please wait...');

  switch(type) {
    case 'pdf':
      exportReport();
      break;
    case 'monthly':
    case 'comparison':
    case 'outstanding':
      google.script.run
        .withSuccessHandler(function() {
          showToast('success', 'Success', 'Report generated successfully');
        })
        .withFailureHandler(function(error) {
          showToast('error', 'Error', error.message);
        })
        .generateReport(type, currentMonth);
      break;
  }
}

function emailReport() {
  const email = prompt('Enter email address:');
  if (!email) return;

  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    showToast('error', 'Invalid Email', 'Please enter a valid email address');
    return;
  }

  showLoading(true);
  google.script.run
    .withSuccessHandler(function() {
      showLoading(false);
      showToast('success', 'Email Sent', 'Report has been sent to ' + email);
    })
    .withFailureHandler(function(error) {
      showLoading(false);
      showToast('error', 'Email Failed', error.message);
    })
    .sendReportEmail(email);
}

function addNewMonth() {
  const month = prompt('Enter month (e.g., DEC-2025):');
  if (!month) return;

  if (!/^[A-Z]{3}-\d{4}$/i.test(month.toUpperCase())) {
    showToast('error', 'Invalid Format', 'Please use format MMM-YYYY (e.g., DEC-2025)');
    return;
  }

  showLoading(true);
  google.script.run
    .withSuccessHandler(function() {
      showLoading(false);
      showToast('success', 'Month Added', month.toUpperCase() + ' has been created');
      loadDashboardData(); // Refresh
    })
    .withFailureHandler(function(error) {
      showLoading(false);
      showToast('error', 'Failed', error.message);
    })
    .addNewMonth(month.toUpperCase(), false);
}

function openSettings() {
  google.script.run.openSettings();
}

/* ==================== Utilities ==================== */
function formatCurrency(value) {
  if (value === null || value === undefined || isNaN(value)) return '--';
  return new Intl.NumberFormat('en-SA', {
    style: 'currency',
    currency: 'SAR',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(value);
}

function formatCompact(value) {
  if (Math.abs(value) >= 1000000) {
    return (value / 1000000).toFixed(1) + 'M';
  } else if (Math.abs(value) >= 1000) {
    return (value / 1000).toFixed(0) + 'K';
  }
  return value.toString();
}

function capitalizeFirst(str) {
  if (!str) return '';
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function showLoading(show) {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay) {
    overlay.classList.toggle('active', show);
  }
}

function showToast(type, title, message) {
  const container = document.getElementById('toastContainer');
  if (!container) return;

  const icons = {
    success: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
    error: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
    warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
    info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'
  };

  const toast = document.createElement('div');
  toast.className = 'toast ' + type;
  toast.innerHTML = `
    <span class="toast-icon">${icons[type] || icons.info}</span>
    <div class="toast-content">
      <div class="toast-title">${title}</div>
      <div class="toast-message">${message}</div>
    </div>
    <button class="toast-close" onclick="this.parentElement.remove()">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  `;

  container.appendChild(toast);

  // Auto remove after 5 seconds
  setTimeout(() => {
    if (toast.parentElement) {
      toast.style.animation = 'slideIn 0.3s ease reverse';
      setTimeout(() => toast.remove(), 300);
    }
  }, 5000);
}
</script>
